import pandas as pd
import xlsxwriter

# ... (Your code for reading and preparing data)

# Export to Excel with enhanced formatting
writer = pd.ExcelWriter('maturity_analysis.xlsx', engine='xlsxwriter')
df_grouped.to_excel(writer, sheet_name='Analysis', index=True)  

# Access the workbook and worksheet objects
workbook = writer.book
worksheet = writer.sheets['Analysis']

# ------  Creative Header Formatting ------
header_format = workbook.add_format({
    'bold': True,
    'font_color': 'white',
    'bg_color': '#294F7D',    
    'align': 'center',         
    'border': 1               
})

# Iterate over header names and apply formatting
if isinstance(df_grouped.index, pd.MultiIndex):
    levels = df_grouped.index.names
else:
    levels = [df_grouped.name]  

for col_num, level in enumerate(levels):
    worksheet.write(0, col_num, level, header_format)

# ------  Improved Number Formatting ------
number_format = workbook.add_format({
    'num_format': '#,##0_);[Red]_(#,##0)',  
    'align': 'right'                        
})

# Apply number formatting (revised)
for row in range(1, len(df_grouped) + 1):
    for col in range(len(df_grouped.columns)):
        worksheet.write(row, col, df_grouped.iloc[row - 1, col], number_format) 

writer.save()
