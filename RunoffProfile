import pandas as pd
import xlsxwriter

# ... (Your code for reading and preparing data)

# Export to Excel with some formatting
writer = pd.ExcelWriter('maturity_analysis.xlsx', engine='xlsxwriter')
df_grouped.to_excel(writer, sheet_name='Analysis', index=True)  # Include index

# Access the workbook and worksheet objects
workbook = writer.book
worksheet = writer.sheets['Analysis']

# Add header formatting
header_format = workbook.add_format({'bold': True, 'bg_color': '#f0f0f0'})

# Iterate over column names or index levels
if isinstance(df_grouped.index, pd.MultiIndex):
    levels = df_grouped.index.names
else:
    levels = [df_grouped.name]  # Single index

for col_num, level in enumerate(levels):
    worksheet.write(0, col_num, level, header_format)

# ... (Rest of the number formatting code remains the same)
