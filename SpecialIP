# Filter data for Buy to Let and Owner Occupied
buy_to_let = tdf[tdf['Occupancy'] == 'BTL']
owner_occupied = tdf[tdf['Occupancy'] == 'Owner Occupied']

# Group by DQ status and calculate mean values for Buy to Let
btl_aggregates = buy_to_let.groupby('DQ')[['Loan Amount', 'Property Value', 'Current Balance']].mean()

# Group by DQ status and calculate mean values for Owner Occupied
owner_aggregates = owner_occupied.groupby('DQ')[['Loan Amount', 'Property Value', 'Current Balance']].mean()

# Display the aggregates
print("Aggregated Data for Buy to Let:")
print(btl_aggregates)

print("\nAggregated Data for Owner Occupied:")
print(owner_aggregates)

# Visualize with box plots for both sets of data
plt.figure(figsize=(14, 10))

# Buy to Let: Loan Amount vs DQ
plt.subplot(2, 2, 1)
sns.boxplot(x='DQ', y='Loan Amount', data=buy_to_let)
plt.title('Loan Amount by DQ Status (Buy to Let)')
plt.xlabel('DQ Status')
plt.ylabel('Loan Amount')

# Buy to Let: Property Value vs DQ
plt.subplot(2, 2, 2)
sns.boxplot(x='DQ', y='Property Value', data=buy_to_let)
plt.title('Property Value by DQ Status (Buy to Let)')
plt.xlabel('DQ Status')
plt.ylabel('Property Value')

# Owner Occupied: Loan Amount vs DQ
plt.subplot(2, 2, 3)
sns.boxplot(x='DQ', y='Loan Amount', data=owner_occupied)
plt.title('Loan Amount by DQ Status (Owner Occupied)')
plt.xlabel('DQ Status')
plt.ylabel('Loan Amount')

# Owner Occupied: Property Value vs DQ
plt.subplot(2, 2, 4)
sns.boxplot(x='DQ', y='Property Value', data=owner_occupied)
plt.title('Property Value by DQ Status (Owner Occupied)')
plt.xlabel('DQ Status')
plt.ylabel('Property Value')

plt.tight_layout()
plt.show()
