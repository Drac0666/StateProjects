# pip install sdmx1 pandas
import sdmx
import pandas as pd

# 1) Connect to ECB
ecb = sdmx.Client("ECB")  # official source id

# EXR = ECB Exchange Rates; dimensions are:
# FREQ • CURRENCY • CURRENCY_DENOM • EXR_TYPE • EXR_SUFFIX
# We'll fetch daily spot (SP00) rates, EUR as denominator, series variation 'A'.
key = {
    "FREQ": "D",
    "CURRENCY": "USD",         # change or pass a list like ["USD", "CHF"]
    "CURRENCY_DENOM": "EUR",
    "EXR_TYPE": "SP00",
    "EXR_SUFFIX": "A",
}

# 2) Optional query params (time window + make time the observation dimension)
params = {
    "startPeriod": "2020",                 # or e.g. "2024-01"
    "dimensionAtObservation": "TIME_PERIOD"
}

# 3) Fetch data and convert to pandas
msg = ecb.get(resource_type="data", resource_id="EXR", key=key, params=params)
df = sdmx.to_pandas(msg)  # Time index, columns = other dims

# 4) Get a clean Series for EURUSD (daily)
eurusd = df.xs(("D","USD","EUR","SP00","A"), level=df.columns.names, axis=1).squeeze()
eurusd.name = "EURUSD_ECB_SP00"

# Latest value
latest_date = eurusd.index.max()
latest_value = eurusd.loc[latest_date]
print(latest_date, latest_value)

# If you want multiple currencies in one go:
key_multi = {**key, "CURRENCY": ["USD", "CHF", "GBP", "JPY"]}
msg2 = ecb.get("data", "EXR", key=key_multi, params=params)
wide = sdmx.to_pandas(msg2)
panel = wide.stack().rename("rate").reset_index().rename(
    columns={"TIME_PERIOD": "date", "CURRENCY": "currency"}
)
# panel -> tidy: date, other dims..., rate
