limit_num = pd.to_numeric(out["Limit"], errors="coerce")  # may be NaN
exp_cum = pd.to_numeric(out["Exposure_Cumulative_WorseOrEqual"], errors="coerce").fillna(0.0)

out["Utilization"] = np.where(
    limit_num.fillna(0.0) > 0,
    exp_cum / limit_num,
    np.nan
)

out["Breach"] = np.where(
    (exp_cum > 0) & (limit_num.fillna(0.0) <= 0),  # exposure but no/zero limit => breach
    1,
    np.where(out["Utilization"] >= 1, 1, 0)
)
