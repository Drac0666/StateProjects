def compare_group(group):
    group = group.sort_values(by='As_of_date')

    for col in ['RTG_FITCH_MAPPED', 'RTG_MOODY_MAPPED', 'RTG_SP_MAPPED', 'RTG_DBRS_MAPPED']:
        shifted = group[col].shift()
        change_col = f'{col}_CHANGE'
        group[change_col] = ~(group[col].eq(shifted))
        group.loc[shifted.isna(), change_col] = False  # No previous value -> no change

    return group
