import pandas as pd
import os
from openpyxl import load_workbook
from openpyxl.utils.dataframe import dataframe_to_rows
from openpyxl.worksheet.hyperlink import Hyperlink

# Let's assume you already have your updated DataFrames:
# df_upgrade_new, df_downgrade_new, df_others_new

# Output file path
output_path = r"C:\Your\Path\output.xlsx"

# Write dataframes normally first
with pd.ExcelWriter(output_path, engine='openpyxl') as writer:
    df_upgrade_new.to_excel(writer, sheet_name='Upgrades', index=False)
    df_downgrade_new.to_excel(writer, sheet_name='Downgrades', index=False)
    df_others_new.to_excel(writer, sheet_name='Others', index=False)

# Now reopen and apply hyperlinks
wb = load_workbook(output_path)

for sheet_name in ['Upgrades', 'Downgrades', 'Others']:
    ws = wb[sheet_name]

    # Find the column number for 'file'
    file_col_idx = None
    for idx, cell in enumerate(ws[1], start=1):
        if cell.value == 'file':
            file_col_idx = idx
            break

    if file_col_idx is None:
        continue  # no file column found, skip

    # Apply hyperlinks to 'file' column
    for row in ws.iter_rows(min_row=2, min_col=file_col_idx, max_col=file_col_idx):
        for cell in row:
            file_path = cell.value
            if os.path.exists(file_path):  # optional: validate path exists
                cell.hyperlink = file_path
                cell.style = "Hyperlink"

wb.save(output_path)
wb.close()
