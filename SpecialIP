import os
import shutil
import pandas as pd
from openpyxl import load_workbook
from datetime import datetime

# Sample DataFrame
data = {
    "Final Asset Class": ["Class A", "Class A", "Class B"],
    "cusip": ["CUSIP1", "CUSIP2", "CUSIP3"],
    "FileMapping": ["file1.xlsx", "file2.xlsx", "file3.xlsx"],
}
df = pd.DataFrame(data)

# Base path for folder structure
mypath = r"C:\Your\Base\Path"  # Replace with your desired base path

# Group by Final Asset Class and add Cusip_Sequence
df['Cusip_Sequence'] = df.groupby('Final Asset Class').cumcount() + 1

# Ensure base path exists
os.makedirs(mypath, exist_ok=True)

# Print current time before starting the loop
start_time = datetime.now()
print(f"Start time: {start_time}")

# Iterate over the DataFrame rows
for idx, row in df.iterrows():
    final_asset_class = row["Final Asset Class"]
    cusip = row["cusip"]
    file_mapping = row["FileMapping"]
    cusip_sequence = row["Cusip_Sequence"]
    
    # Construct folder path
    folder_path = os.path.join(mypath, final_asset_class, f"{cusip_sequence}. {cusip}")
    os.makedirs(folder_path, exist_ok=True)
    
    # Copy file to the folder
    destination_file = os.path.join(folder_path, os.path.basename(file_mapping))
    shutil.copy(file_mapping, destination_file)
    
    # Edit the file to put cusip in cell A2
    wb = load_workbook(destination_file)
    ws = wb.active
    ws["A2"] = cusip
    wb.save(destination_file)

# Print current time after the loop
end_time = datetime.now()
print(f"End time: {end_time}")

# Calculate execution time
total_time = end_time - start_time
print(f"Total execution time: {total_time}")

# Estimate time per row
time_per_row = total_time / len(df)
print(f"Estimated time per row: {time_per_row}")
