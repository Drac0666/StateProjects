import pandas as pd
import plotly.graph_objects as go

# Load filtered full data (filtered_full_data)
df_initial = get_security_data(initial_security)

fig = go.Figure()

# Let's plot Fitch MAPPED with text labels from Bloomberg Fitch
fig.add_trace(go.Scatter(
    x=df_initial['As_of_Date'],
    y=df_initial['RTG_FITCH_MAPPED'],
    mode='lines+markers+text',
    text=df_initial['Bloomberg_Fitch'],  # these are the text labels
    textposition='top center',
    name='Fitch'
))

# You can repeat for Moody's:
fig.add_trace(go.Scatter(
    x=df_initial['As_of_Date'],
    y=df_initial['RTG_MOODY_MAPPED'],
    mode='lines+markers+text',
    text=df_initial['Bloomberg_Moodys'],
    textposition='top center',
    name='Moody\'s'
))

# Same for SP:
fig.add_trace(go.Scatter(
    x=df_initial['As_of_Date'],
    y=df_initial['RTG_SP_MAPPED'],
    mode='lines+markers+text',
    text=df_initial['Bloomberg_SP'],
    textposition='top center',
    name='S&P'
))

# And DBRS:
fig.add_trace(go.Scatter(
    x=df_initial['As_of_Date'],
    y=df_initial['RTG_DBRS_MAPPED'],
    mode='lines+markers+text',
    text=df_initial['Bloomberg_DBRS'],
    textposition='top center',
    name='DBRS'
))

fig.update_layout(
    title=f"Security: {security_label_map[initial_security]}",
    xaxis_title="As of Date",
    yaxis_title="Mapped Rating (higher is better)",
    updatemenus=[dict(
        active=0,
        buttons=dropdown_buttons,
        x=1.15,
        y=1.0
    )],
    legend=dict(x=1.05, y=0.5)
)

fig.show()

# Export as standalone HTML
fig.write_html("ratings_dashboard.html", full_html=True, include_plotlyjs='cdn')
