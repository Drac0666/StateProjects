import requests
import pandas as pd

# New ECB Data Portal API endpoint
url = "https://data-api.ecb.europa.eu/service/data/EXR/D.USD.EUR.SP00.A"

params = {
    "format": "jsondata",
    "startPeriod": "2024-01-01"
}

r = requests.get(url, params=params)
r.raise_for_status()
data = r.json()

# The structure under the new ECB Data Portal looks like:
# data["structure"] -> metadata
# data["dataSets"] -> actual series and observations
series = data["dataSets"][0]["series"]["0:0:0:0:0"]
obs = series["observations"]

# Dates are defined in structure->dimensions->observation
dates = [v["id"] for v in data["structure"]["dimensions"]["observation"][0]["values"]]

# Convert to pandas Series
values = [float(obs[str(i)][0]) if str(i) in obs else None for i in range(len(dates))]
rates = pd.Series(values, index=pd.to_datetime(dates), name="EURUSD (USD per 1 EUR)")

print(rates.tail())
