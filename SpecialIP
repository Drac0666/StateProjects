def detect_anomaly(db_file: str = DB_FILE):
    df = pd.read_excel(db_file, index_col=ISIN_COL)
    asset_class = df["Asset Class"]
    df = df.drop(columns="Asset Class")
    date_columns = list(df.columns)

    anomalies = []

    for isin, row in df.iterrows():
        values = row.astype(float).tolist()
        for i in range(1, len(values)):
            prev_val = values[i - 1]
            curr_val = values[i]
            if (prev_val > 0 and curr_val == 0) or (prev_val == 0 and curr_val > 0):
                anomalies.append({
                    "ISIN": isin,
                    "Asset Class": asset_class[isin],
                    "Anomaly Type": "value→0" if prev_val > 0 else "0→value",
                    "Anomaly Window": f"{date_columns[i-1]} → {date_columns[i]}"
                })
                break
                result_df = pd.DataFrame(anomalies)
        result_df.to_excel("anomalies.xlsx", index=False)
        print(f"Anomalies detected and saved to anomalies.xlsx ({len(result_df)} rows)")
    else:
        print("No anomalies detected.")
