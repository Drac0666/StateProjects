import matplotlib.pyplot as plt
import pandas as pd

def CreateBaseYieldsPnLChart(YieldsX, PnL, ColumnsToPlot):
    YieldsX = YieldsX[ColumnsToPlot]

    fig, ax1 = plt.subplots(figsize=(9, 6))

    # Plot each column in YieldsX with its own label
    for column in YieldsX.columns:
        ax1.plot(YieldsX.index, YieldsX[column], label=column)
    
    ax1.set_xlabel("Date")
    ax1.set_ylabel("Yields")
    
    # Set custom ticks on X-axis
    ax1.set_xticks(YieldsX.index[::2])  # Show every second date (customize as needed)
    ax1.tick_params(axis='x', rotation=45)
    
    # Set up secondary y-axis for PnL
    ax2 = ax1.twinx()
    ax2.plot(PnL.index, PnL, 'r--', linewidth=3, label="10Y Yields (Except Germany and UST)")
    ax2.set_ylabel("Unrealized P/L")
    
    # Format the secondary y-axis to avoid scientific notation
    ax2.ticklabel_format(style='plain', axis='y')
    
    # Adding title and customizations
    plt.title("Yields and SSBI Unrealized P/L Development", pad=20)
    
    # Combine legends from both axes and position it near the right axis
    lines_1, labels_1 = ax1.get_legend_handles_labels()
    lines_2, labels_2 = ax2.get_legend_handles_labels()
    ax1.legend(lines_1 + lines_2, labels_1 + labels_2, loc='center left', bbox_to_anchor=(1.05, 0.5), frameon=False)

    plt.tight_layout()
    
    # Save the figure
    plt.savefig("Test2.png")

# Example DataFrames (replace with your actual data)
YieldsX = pd.DataFrame({
    'Date': pd.date_range(start='1/1/2021', periods=10),
    'Yields_1': range(10, 20),
    'Yields_2': range(20, 30)
})
PnL = pd.DataFrame({
    'Date': pd.date_range(start='1/1/2021', periods=10),
    'PnL': range(10, 20)
})
YieldsX.set_index('Date', inplace=True)
PnL.set_index('Date', inplace=True)

# Example columns to plot
ColumnsToPlot = ['Yields_1', 'Yields_2']

# Create the chart
CreateBaseYieldsPnLChart(YieldsX, PnL, ColumnsToPlot)
