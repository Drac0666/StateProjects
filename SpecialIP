import pandas as pd
from statsmodels.stats.proportion import proportions_ztest

# Assuming 'df' is your DataFrame with columns 'IssueDate' and 'DQ'
# Convert IssueDate to datetime if it's not already
df['IssueDate'] = pd.to_datetime(df['IssueDate'], errors='coerce')

# Group data based on IssueDate
group1 = df[df['IssueDate'] < '2014']
group2 = df[df['IssueDate'] >= '2014']

# Calculate the counts of DQ=1 in each group and the total observations
count_dq1_group1 = group1['DQ'].sum()  # Count of DQ=1 for IssueDate < 2014
count_dq1_group2 = group2['DQ'].sum()  # Count of DQ=1 for IssueDate >= 2014

n_group1 = group1.shape[0]  # Total observations for IssueDate < 2014
n_group2 = group2.shape[0]  # Total observations for IssueDate >= 2014

# Perform two-proportion z-test
count = [count_dq1_group1, count_dq1_group2]
nobs = [n_group1, n_group2]
stat, pval = proportions_ztest(count, nobs)

print("Z-Statistic:", stat)
print("p-value:", pval)
