def generate_activity(db_file: str = DB_FILE):
    df = pd.read_excel(db_file, index_col=ISIN_COL)
    asset_class = df["Asset Class"]
    df = df.drop(columns="Asset Class")
    date_columns = list(df.columns)

    activity = []

    for isin, row in df.iterrows():
        values = row.tolist()

        # Purchase: first non-zero value
        for i, val in enumerate(values):
            if val > 0:
                activity.append({
                    "Date": date_columns[i],
                    "ISIN": isin,
                    "Asset Class": asset_class[isin],
                    "Activity": "Purchase",
                    "Value": val
                })
                break

        # Paidoff: first 0 after a value > 0
        had_value = False
        for i, val in enumerate(values):
            if val > 0:
                had_value = True
            elif val == 0 and had_value:
                activity.append({
                    "Date": date_columns[i],
                    "ISIN": isin,
                    "Asset Class": asset_class[isin],
                    "Activity": "Paidoff",
                    "Value": 0
                })
                break

    if activity:
        activity_df = pd.DataFrame(activity)
        activity_df.to_excel("activity_log.xlsx", index=False)
        print("Activity log saved to activity_log.xlsx")
    else:
        print("No purchase or paidoff events detected.")
