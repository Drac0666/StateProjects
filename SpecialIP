# --- After you have `spreads_tidy` and `spreads_wide` DataFrames ---
import pandas as pd
from datetime import datetime

outfile = f"spreads_{datetime.now().date()}.xlsx"

with pd.ExcelWriter(
    outfile,
    engine="xlsxwriter",
    datetime_format="yyyy-mm-dd",
    date_format="yyyy-mm-dd",
) as writer:
    # Write sheets
    spreads_tidy.to_excel(writer, sheet_name="Spreads_Tidy", index=False)
    spreads_wide.reset_index().to_excel(writer, sheet_name="Spreads_Wide", index=False)

    # Basic formatting: freeze header + auto width
    wb = writer.book
    for sheet_name, df_ in {
        "Spreads_Tidy": spreads_tidy,
        "Spreads_Wide": spreads_wide.reset_index(),
    }.items():
        ws = writer.sheets[sheet_name]
        ws.freeze_panes(1, 0)  # freeze header row
        for col_idx, col_name in enumerate(df_.columns):
            # heuristic for width: max of header and sample cell lengths
            sample = df_[col_name].astype(str).str.len().clip(upper=40).max()
            width = max(len(str(col_name)) + 2, int(sample) + 2 if pd.notna(sample) else 12, 12)
            ws.set_column(col_idx, col_idx, width)

print(f"Excel written to: {outfile}")
