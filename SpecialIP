import pandas as pd

# Sample DataFrame
# Ensure 'Issue Date' is datetime, and you have 'Orig LTV' column
df['Issue Date'] = pd.to_datetime(df['Issue Date'], errors='coerce')

# Group by year and calculate the average 'Orig LTV' for each year
df['Issue Year'] = df['Issue Date'].dt.year
avg_ltv_by_year = df.groupby('Issue Year')['Orig LTV'].mean()

# Define a function to fill missing 'Orig LTV' values based on the average for the year
def fill_ltv(row):
    if pd.isnull(row['Orig LTV']):
        return avg_ltv_by_year.get(row['Issue Year'], row['Orig LTV'])
    return row['Orig LTV']

# Apply the function to fill missing values
df['Orig LTV'] = df.apply(fill_ltv, axis=1)

# Drop the helper column 'Issue Year' if not needed
df.drop(columns=['Issue Year'], inplace=True)

# Display the updated DataFrame
import ace_tools as tools; tools.display_dataframe_to_user(name="Updated DataFrame", dataframe=df)
