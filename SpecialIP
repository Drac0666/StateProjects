def generate_activity(db_file: str = DB_FILE):
    """Generate a log of Purchase and Paidoff events based on value changes over time."""
    df = pd.read_excel(db_file, index_col=ISIN_COL)
    asset_class = df["Asset Class"]
    df = df.drop(columns="Asset Class")
    date_columns = list(df.columns)

    activity = []

    for isin, row in df.iterrows():
        values = row.tolist()

        # Find first appearance with non-zero value that is not on the first column
        if values[0] == 0:
            for i in range(1, len(values)):
                if values[i] > 0:
                    activity.append({
                        "Date": date_columns[i],
                        "ISIN": isin,
                        "Asset Class": asset_class[isin],
                        "Activity": "Purchase",
                        "Value": values[i]
                    })
                    break

        # Find transition from >0 to 0 and capture the last non-zero value
        for i in range(1, len(values)):
            if values[i-1] > 0 and values[i] == 0:
                activity.append({
                    "Date": date_columns[i],
                    "ISIN": isin,
                    "Asset Class": asset_class[isin],
                    "Activity": "Paidoff",
                    "Value": values[i-1]
                })
                break
        
    else:
        print("No purchase or paidoff events detected.")

    if activity:
        activity_df = pd.DataFrame(activity)
        activity_df.to_excel("activity_log.xlsx", index=False)
        print("Activity log saved to activity_log.xlsx")
