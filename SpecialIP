import pandas as pd
from openpyxl.utils.dataframe import dataframe_to_rows
from openpyxl import Workbook

# Example lists (replace with your actual lists)
dataframes = [df1, df2, df3]  # Your list of dataframes
sheet_names = ['Sheet1', 'Sheet2', 'Sheet3']  # Your list of names (same length/order as dataframes)

# Create a workbook
wb = Workbook()

# Remove the default sheet
default_sheet = wb.active
wb.remove(default_sheet)

# Loop through dataframes and names
for df, name in zip(dataframes, sheet_names):
    ws = wb.create_sheet(title=name)
    
    # Write dataframe to worksheet
    for row in dataframe_to_rows(df, index=False, header=True):
        ws.append(row)
    
    # Auto-adjust column widths
    for column_cells in ws.columns:
        max_length = 0
        column = column_cells[0].column_letter  # Get the column name (A, B, C...)
        
        for cell in column_cells:
            try:
                cell_value = str(cell.value)
                if cell_value:
                    max_length = max(max_length, len(cell_value))
            except:
                pass
        
        adjusted_width = max_length + 2
        ws.column_dimensions[column].width = adjusted_width

# Save the workbook
wb.save('Combined_Dataframes.xlsx')

print("Excel file created successfully!")
