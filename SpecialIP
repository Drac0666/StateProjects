import pandas as pd

# Replace zeros with blanks (optional)
pivot_pct = pivot_pct.replace(0, "")
bolipivot_pct = bolipivot_pct.replace(0, "")

output_path = "output.xlsx"

with pd.ExcelWriter(output_path, engine='xlsxwriter') as writer:
    workbook = writer.book

    # ---------- Define Formats ----------
    header_fmt = workbook.add_format({
        'bold': True,
        'text_wrap': True,
        'valign': 'middle',
        'align': 'center',
        'border': 1,
        'bg_color': '#DCE6F1'
    })
    number_fmt = workbook.add_format({'num_format': '#,##0', 'border': 1})
    percent_fmt = workbook.add_format({'num_format': '0.00%', 'border': 1})

    # ---------- Helper Function ----------
    def write_table(sheet_name, df, start_row, start_col, body_format):
        """Writes a DataFrame and applies header/body formatting."""
        df.to_excel(writer, sheet_name=sheet_name, startrow=start_row, startcol=start_col)
        ws = writer.sheets[sheet_name]

        # Header formatting
        headers = df.reset_index().columns.tolist()
        for col_num, col_name in enumerate(headers):
            ws.write(start_row, start_col + col_num, col_name, header_fmt)

        # Apply cell formatting to columns (safe since tables now don’t overlap)
        ws.set_column(start_col, start_col + len(headers) - 1, 12, body_format)

        # Return next available row position
        return start_row + len(df) + 3

    # ---------- Sheet: IP ----------
    next_row = 0
    # Value pivot on the left
    next_row = write_table('IP', pivot, start_row=next_row, start_col=0, body_format=number_fmt)
    # Percentage pivot on the right
    write_table('IP', pivot_pct, start_row=0, start_col=len(pivot.columns) + 4, body_format=percent_fmt)

    # ---------- Sheet: BOLI ----------
    next_row = 0
    next_row = write_table('BOLI', bolipivot, start_row=next_row, start_col=0, body_format=number_fmt)
    write_table('BOLI', bolipivot_pct, start_row=0, start_col=len(bolipivot.columns) + 4, body_format=percent_fmt)

print(f"✅ Excel file created successfully → {output_path}")
