import wx
import win32com.client
import re

class OutlookEmailSearchFrame(wx.Frame):
    def __init__(self):
        super().__init__(None, title="Search Outlook Emails", size=(600, 400))

        self.panel = wx.Panel(self)
        self.vbox = wx.BoxSizer(wx.VERTICAL)

        self.label = wx.StaticText(self.panel, label='Enter a date (e.g., "01/01/2023"):')
        self.date_input = wx.TextCtrl(self.panel)
        self.search_button = wx.Button(self.panel, label='Search Outlook Emails')
        self.email_list = wx.TextCtrl(self.panel, style=wx.TE_MULTILINE | wx.TE_READONLY)

        self.vbox.Add(self.label, 0, wx.ALL | wx.EXPAND, 5)
        self.vbox.Add(self.date_input, 0, wx.ALL | wx.EXPAND, 5)
        self.vbox.Add(self.search_button, 0, wx.ALL | wx.EXPAND, 5)
        self.vbox.Add(self.email_list, 1, wx.ALL | wx.EXPAND, 5)

        self.panel.SetSizer(self.vbox)

        self.search_button.Bind(wx.EVT_BUTTON, self.on_search)

    def open_outlook_email(self, email_subject):
        try:
            outlook = win32com.client.Dispatch("Outlook.Application").GetNamespace("MAPI")
            inbox = outlook.GetDefaultFolder(6)  # 6 represents the Inbox folder

            for email in inbox.Items:
                if re.search(email_subject, email.Subject, re.I):
                    email.Display()
                    break
        except Exception as e:
            print(f"Error: {e}")

    def search_outlook_emails(self, path):
        found_emails = []
        try:
            outlook = win32com.client.Dispatch("Outlook.Application").GetNamespace("MAPI")
            inbox = outlook.GetDefaultFolder(6)  # 6 represents the Inbox folder

            emails = inbox.Items
            emails.Restrict(f"[ReceivedTime] >= '{path}'")

            for email in emails:
                found_emails.append(f"Subject: {email.Subject}, Received Time: {email.ReceivedTime}")

            return found_emails
        except Exception as e:
            print(f"Error: {e}")
            return []

    def on_search(self, event):
        self.email_list.Clear()
        path = self.date_input.GetValue()
        found_emails = self.search_outlook_emails(path)
        for email in found_emails:
            self.email_list.AppendText(email + '\n')

if __name__ == '__main__':
    app = wx.App()
    frame = OutlookEmailSearchFrame()
    frame.Show()
    app.MainLoop()
