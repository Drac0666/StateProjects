import win32com.client
import psutil

def get_outlook_app():
    try:
        # Attempt to get an instance of an existing Outlook process
        outlook_app = win32com.client.GetActiveObject("Outlook.Application")
        print("Outlook is already running. Dispatching the existing instance.")
        return outlook_app
    except:
        # If Outlook is not running, start it
        if not any("OUTLOOK.EXE" in p.name() for p in psutil.process_iter()):
            try:
                outlook_app = win32com.client.Dispatch("Outlook.Application")
                print("Outlook started successfully.")
                return outlook_app
            except Exception as e:
                print(f"Error starting Outlook: {e}")
        else:
            print("Outlook process found but could not be dispatched.")
        return None  # Return None if Outlook is not running or encountered an error

# Example usage
outlook = get_outlook_app()

if outlook is not None:
    # You can now use the 'outlook' object to work with Outlook.
    inbox = outlook.GetNamespace("MAPI").GetDefaultFolder(6)  # 6 represents the Inbox folder
    messages = inbox.Items
    print(f"Number of emails in the Inbox: {len(messages)}")
